3Dモデルがガウス分布の集まりによって表すことができるなら,
→　画像に映る物体に対応するガウス分布があるはず
物体が動く→それに対応するガウス分布も動くはず。
物体の動きを学習モデルに組み込んで最適化すれば
動的物体の動きを表現した3Dモデルを構成できるはず。
そこで、以下のように被写体の動きに合わせたガウス分布の移動を実現する。
基準となる画像$I_0$での物体$a_i(i=1,2,...)$の位置をそれぞれ基準として,
任意の画像$I_j(j=1,2,3,...)$における物体$a_i$の位置を$T_{ij}$,
回転角を$R_{ij}$とすると,ガウス分布$G_n(n=1,2,...)$の画像$I_j$での位置$μ_{nj}$は,
$
\mu_{nj} = (w_{1j}R_{1j}+w_{2j}R_{2j}+...+w_{ij}R_{ij})\mu_{n0} + (w_{1j}T_{1j}+w_{2j}T_{2j}+...+w_{ij}T_{ij})  
$
ここで,$\mu_{n0}$は,基準画像$I_0$でのガウス分布$G_n$の位置である.
また,$i=1,2,3,...$のうちの一つの元i=kに対して, $w_{kj} = 1$ なら,
それ以外のi=1,2,...,k-1,k+1,...に対して,$w_{ij} = 0$となる.

$
w_{ij} = 
\begin{Bmatrix}
1 \ \ (i=k) \\
0 \ \ (i≠k)
\end{Bmatrix}
$

このようにすれば,ガウス分布は常に一つの物体に一対一に対応することになる.
ガウス分布が動かない物体に対応する場合はその添字をi=mとするとき,
$
R_{mj} = I = \begin{pmatrix}
1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 1
\end{pmatrix}
, T_{mj} = \begin{pmatrix}
0  \\
0  \\
0 
\end{pmatrix}
$
とすればよい.
しかし、この方法は$\mu_{nj}$が非連続関数かつ微分不可能になり勾配計算ができない.
→ w を線形補間する.つまり,
$w_{1j}+w_{2j}+,...,+w_{ij} = 1$の制約条件の下で勾配計算する!
→問題(1): 制約条件ありの勾配計算はラグランジュの未定乗数λを勾配に追加することになり,
計算及び実装が大変→　解決策: $f:[-\infty,\infty]→[0,1],\ x_{ij}→w_{ij}$かつ
$w_{1j}+w_{2j}+,...,+w_{ij} = f(x_{1j})+f(x_{2j})+,...,+f(x_{ij}) = 1$
となるような関数fを使えばよい.
その関数として,ソフトマックス関数を用いる.
$
ソフトマックス関数: \displaystyle w_{ij} = f(x_{ij}) = \frac{e^{x_{ij}}}{\sum_{l}e^{x_{lj}}}  
$
→問題(2): 上のソフトマックス関数を用いて,
$
\displaystyle \mu_{nj} = \left(\sum_{l} f(x_{lj})R_{lj} \right)\mu_{n0} + \left(\sum_{l} f(x_{lj})T_{lj} \right)
$
と表現すると,$R_{j} = \sum_{l} f(x_{lj})R_{lj} $が回転行列になる保証がない.
→　回転行列は行列式$|R_{j}|=1$かつ$R_{ij}R^T_{ij} =  I$を満たす.$I$は3×3の単位行列
つまり,直交行列であって行列式が1となるようにしないと,
物理的な意味がない.
→解決策: リー群の対数写像を用いる.
群について簡単に説明.
集合Gが演算[・]に対して群をなすとは,
$
(1):\ \forall g_1,g_2 \in G,\ g_1 \cdot g_2 \in G \to 代数的に閉じている.
\\ (2): \forall g_1,g_2,g_3 \in G, \ (\ g_1\cdot g_2) \cdot g_3 = \ g_1\cdot (g_2 \cdot g_3) =  \ g_1\cdot g_2 \cdot g_3 \to 結合法則を満たす \\
(3): \forall g \in G,\ g \cdot I = I \cdot g = g, \ I \in G \to 単位元の存在 
\\(4): \forall g \in G,\ g \cdot g^{-1} = g^{-1} \cdot g = I, \ g^{-1} \in G \to 逆元の存在
$
例: 回転行列R_1,R_2に対して$|R_1R_2|=|R_1||R_2|=1\cdot 1=1$で回転行列,単位行列Iは行列積の性質から,
$RI=IR=R$,また回転行列は直交行列なので$RR^{T}=R^TR=I$で結合法則も満たすから,
回転行列全体の集合は,行列積に対して群をなす.
リー群とは,群の構造に微分可能な多様体(座標を構成できる)の構造をもたせたもの.
アイデアの骨格：回転行列は加算ではなく行列積に対して群をなすから,
さきほどの線形補間を以下のように書き換える.
$
\displaystyle \mu_{nj} = \left(\prod_{l} f(x_{lj})R_{lj} \right)\mu_{n0} + \left(\sum_{l} f(x_{lj})T_{lj} \right)
$
こうすると$\mu_{n0}$の係数は、回転行列となるようにみえる.しかし,
$
|f(x_{1j})R_{1j}f(x_{2j})R_{2j}| = |f(x_{1j})||R_{1j}||f(x_{2j})||R_{2j}| = f(x_{1j})f(x_{2j})
$
で行列式は1にならない.また,理想的な状態
$
w_{ij} = 
\begin{Bmatrix}
1 \ \ (i=k) \\
0 \ \ (i≠k)
\end{Bmatrix}
$
のとき,常に,
$
\displaystyle R_j = \prod_{l} f(x_{lj})R_{lj} = \begin{pmatrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0
\end{pmatrix} \notin R
$
となる.
実際は,ソフトマックス関数の性質で0にならないが物理的に意味のある形ではないことがわかる.
それで,回転行列Rの対数$\log(R)$全体の集合は,加算[+]に対して群をなすという性質を利用する.
つまり,回転行列の対数全体の集合を$\log(R)$と表すとき,
$
\displaystyle \forall R_1,R_2,...,R_i \in R,\ \sum_{k=1}^i\log(R_k) \in \log(R)
$
さらに,回転行列の対数$log(R_i)$のスカラー倍の線形結合の指数写像は回転行列である.
$
\displaystyle \exp\left\{\sum_{l}w_{lj}\log(R_{lj})\right\} \in R
$
この事実から,$\mu_{nj}$は以下のように定めると物理的な意味を持つ形で表現できるはずである.
$
\displaystyle \mu_{nj} = \exp\left\{\sum_{l}f(x_{lj})\log(R_{lj})\right\}\mu_{n0} + \left(\sum_{l} f(x_{lj})T_{lj} \right)
$
しかし,問題が一つある.

$\exp\left\{\sum_{l}w_{lj}\log(R_{lj})\right\} = R_j$となる回転行列$R_j$は複数存在するため,仮に

$
w_{ij} = f(x_{ij}) =
\begin{Bmatrix}
1 \ \ (i=k) \\
0 \ \ (i≠k)
\end{Bmatrix}
$
のとき,
$
R_j \displaystyle = \exp\left\{\sum_{l}f(x_{lj})\log(R_{lj})\right\} = e^{\log(R_{kj})} = R_{kj}
$
となる保証がないことである.
これについて,リー代数について勉強して解決策を調べる。




目的： SfM等で得られたワールド座標 $\mathbf{r}_w$ のガウスを、カメラの外部パラメータ $(\mathbf{R}, \mathbf{T})$ を用いてカメラ座標 $\mathbf{r}_c$ に写像する。

変換式 (アフィン変換):
$\mathbf{r}_c = \mathbf{R} \mathbf{r}_w + \mathbf{T}$

ガウスの不変性： ガウス分布はアフィン変換に対して閉じており、変換後もガウス分布の形を保つ。

パラメータの変換：
平均ベクトル: $\boldsymbol{\mu}_c = \mathbf{R} \boldsymbol{\mu}_w + \mathbf{T}$
共分散行列: $\boldsymbol{\Sigma}_c = \mathbf{R} \boldsymbol{\Sigma}_w \mathbf{R}^\mathrm{T}$
